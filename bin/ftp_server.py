#!/usr/bin/env python3

import argparse

from pyftpdlib.authorizers import DummyAuthorizer
from pyftpdlib.handlers import FTPHandler
from pyftpdlib.servers import FTPServer


if __name__ == '__main__':

    parser = argparse.ArgumentParser(
        description='Starts a simple FTP server',
        formatter_class=argparse.ArgumentDefaultsHelpFormatter
    )
    parser.add_argument('-un', '--username', help='Expected username', default='user')
    parser.add_argument('-up', '--password', help='Expected password', default='pass')
    parser.add_argument('-lh', '--addr', help='Listening address', default='')
    parser.add_argument('-lp', '--port', help='Listening port', type=int, default=21)
    parser.add_argument('-p', '--path', help='Exposed local path', default='./')
    parser.add_argument('-b', '--banner', help='Exposed FTP banner', default='FTPd 1.99')
    args = parser.parse_args()

    authorizer = DummyAuthorizer()
    authorizer.add_user(args.username, args.password, args.path, perm='elradfmw')
    handler = FTPHandler
    handler.authorizer = authorizer
    handler.banner = args.banner
    handler.passive_ports = range(60000, 65535)
    address = (args.addr, args.port)
    server = FTPServer(address, handler)
    server.max_cons = 256
    server.max_cons_per_ip = 5
    server.serve_forever()
