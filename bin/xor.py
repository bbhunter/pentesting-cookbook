#!/usr/bin/env python3

import click


def xor(body, key):
    klen = len(key) - 1
    k = 0
    xored = list()
    for i in range(0, len(body)):
        xored.append(body[i] ^ ord(key[k]))
        if k == klen:
            k = 0
        else:
            k += 1
    return xored


def convert_dec(c):
    return int(c)


def convert_hex(c):
    return int(c, 16)


@click.command()
@click.option('--body', '-b', type=str, required=True, help='Input string')
@click.option('--key', '-k', type=str, required=True, help='Key string')
@click.option('--is-list', '-l', default=False, is_flag=True, help='Treat input as comma separated list')
def run(body, key, is_list):
    if is_list:
        body = body.split(',')
        func = convert_hex if 'x' in body[0] else convert_dec
        body = [func(c) for c in body]
    else:
        body = [ord(c) for c in body]
    xored = xor(body, key)
    click.echo(click.style('Int: ' + ','.join([str(c) for c in xored]), fg='green', bold=True))
    click.echo(click.style('Hex: ' + ','.join([hex(c) for c in xored]), fg='yellow', bold=True))
    click.echo('Length: ' + str(len(body)))


if __name__ == '__main__':
    run()
