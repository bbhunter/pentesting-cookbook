#!/usr/bin/env python3

import click


def convert_dec(val):
    return int(val)


def convert_hex(val):
    return int(val, 16)


def convert_input(val, is_list):
    if is_list:
        val = val.split(',')
        func = convert_hex if 'x' in val[0] else convert_dec
        val = [func(c) for c in val]
    else:
        val = [ord(c) for c in val]
    return val


def xor(content, key, is_list):
    key = convert_input(key, is_list)
    klen = len(key) - 1
    k = 0
    xored = list()
    for i in range(0, len(content)):
        xored.append(content[i] ^ key[k])
        if k == klen:
            k = 0
        else:
            k += 1
    return xored


@click.command()
@click.option('--content', '-c', type=str, required=True, help='Content')
@click.option('--key', '-k', type=str, required=True, help='Key')
@click.option('--is-list', '-l', default=False, is_flag=True, help='Treat arguments as comma separated lists of hex or dec values')
def run(content, key, is_list):
    content = convert_input(content, is_list)
    xored = xor(content, key, is_list)
    click.echo(click.style('Int: ' + ','.join([str(c) for c in xored]), fg='green', bold=True))
    click.echo(click.style('Hex: ' + ','.join([hex(c) for c in xored]), fg='yellow', bold=True))
    click.echo('Length: ' + str(len(content)))


if __name__ == '__main__':
    run()
