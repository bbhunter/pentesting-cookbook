#!/bin/bash

if [[ -z $1 ]]; then
    echo "Usage:"
    echo -e "$0 results.gnmap output_filename"
    exit 1
fi

if [[ ! -f "$1" ]]; then
    echo "File not found: $1"
    exit 1
fi

INPUT_FILENAME=$1
OUTPUT_FILENAME=$2

hosts_list() {
    IFS=$'\n' read -r -d '' -a tmp_array < <( grep -E "($1)\/open\/$2" $INPUT_FILENAME | cut -d' ' -f2 | sort | uniq && printf '\0' )
    if (( ${#tmp_array[@]} )); then
        printf '%s\n' "${tmp_array[@]}" > $OUTPUT_FILENAME-$3-$2
    fi
}

hosts_list '21' tcp ftp
hosts_list '22' tcp ssh
hosts_list '23' tcp telnet
hosts_list '25' tcp smtp
hosts_list '53' tcp dns
hosts_list '53' udp dns
hosts_list '69' udp tftp
hosts_list '80|81|82|443|8000|8008|8080|8081|8082|8443|8888|9000|9080|9443|9888|9990' tcp http
hosts_list '111' tcp rpc
hosts_list '111' udp rpc
hosts_list '113' tcp ident
hosts_list '135' tcp msrpc
hosts_list '139|445' tcp smb
hosts_list '161' tcp snmp
hosts_list '161' udp snmp
hosts_list '1433' tcp mssql
hosts_list '3306' tcp mysql
hosts_list '3389' tcp rdp
hosts_list '5432' tcp pgsql
hosts_list '6000|6001|6002|6003|6004|6005' tcp x11
